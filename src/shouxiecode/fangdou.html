<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>防抖函数示例</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        input {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .output {
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
            min-height: 100px;
        }
        .event-log {
            margin-top: 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>防抖函数示例</h1>
        
        <div>
            <label for="search-input">搜索框：</label>
            <input type="text" id="search-input" placeholder="输入内容观察防抖效果">
        </div>
        
        <div>
            <h3>普通输入事件触发次数：</h3>
            <div id="normal-count">0</div>
        </div>
        
        <div>
            <h3>防抖处理后触发次数：</h3>
            <div id="debounce-count">0</div>
        </div>
        
        <div>
            <h3>事件日志：</h3>
            <div class="output" id="event-log"></div>
        </div>
    </div>

    <script>
        /**
         * 防抖函数：触发事件后，延迟执行，若在延迟期间重复触发则重新计时
         * @param {Function} fn 需要防抖的函数
         * @param {number} delay 延迟时间(ms)
         * @returns {Function} 包装后的防抖函数
         */
        function debounce(fn, delay) {
            let timer = null; // 闭包保存定时器
            
            return function(...args) { // 返回新函数
                if (timer) clearTimeout(timer); // 如果已有定时器，清除它（重新计时）
                
                timer = setTimeout(() => { // 设置新定时器
                    fn.apply(this, args); // 延迟结束后执行原函数
                }, delay);
            };
        }

        // 获取DOM元素
        const searchInput = document.getElementById('search-input');
        const normalCount = document.getElementById('normal-count');
        const debounceCount = document.getElementById('debounce-count');
        const eventLog = document.getElementById('event-log');

        // 初始化计数器
        let normalCounter = 0;
        let debounceCounter = 0;

        // 普通输入事件处理
        searchInput.addEventListener('input', () => {
            normalCounter++;
            normalCount.textContent = normalCounter;
            logEvent('普通输入事件触发');
        });

        // 防抖处理后的输入事件
        const debouncedSearch = debounce(() => {
            debounceCounter++;
            debounceCount.textContent = debounceCounter;
            logEvent('防抖处理后执行搜索');
            // 这里可以添加实际的搜索逻辑
            // 例如：fetchSearchResults(searchInput.value);
        }, 500);

        searchInput.addEventListener('input', debouncedSearch);

        // 记录事件日志
        function logEvent(message) {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'event-log';
            logEntry.textContent = `${timeString}: ${message}`;
            eventLog.prepend(logEntry);
            
            // 限制日志数量
            if (eventLog.children.length > 10) {
                eventLog.removeChild(eventLog.lastChild);
            }
        }
    </script>
</body>
</html>